# Command to be executed when the user runs the Gemini CLI command
description = "Support a C# project (.csproj) to build both net472 and net8.0 with changes and known-issues solutions query from the existed MCP query-known-issues-and-solutions tool"

prompt = """
# Task
**Working space is `C:/src/ControlPlane`**
**Check `system-variables-definition.md` to make sure the pre-defined system variables first**
**You are tasked with upgrading a C# project to support both net472 and net8.0 frameworks.**
**Always call command at nodeServer `query-known-issues-and-solutions` to get known issues and solutions when we are targeting a new step.**
**Enable `query-known-issues-and-solutions` query with enhanced:true**

# Steps to follow:
1. **Log all actions to the console before any operation or decision.**
   - Follow [Rule:AlwaysLoggingTaskExecution] pattern
   - Echo clear decision statements before each major action
   - Example: `Decision: Applying [Rule:InternalsVisibleToAlignment] for ConfigurationData project`
   - Example: `Build: Starting build for net472 target`
   - Example: `Summary: Successfully updated TargetFrameworks to net472;net8.0`
   
2. **Always create a new branch before any changes.**
   - Ensure that the branch is based on the latest `master` branch.

3. **Update .csproj file to support multi-targeting for net472 and net8.0.**
   - Add or modify `<TargetFrameworks>` to include both `net472` and `net8.0`.
   - Ensure compatibility for conditional references.

4. **Update any references that need to be adjusted for the two target frameworks.**
   - Modify `<ProjectReference>` and `<PackageReference>` elements to be conditional based on the target framework.
   
5. **Ensure the main project with the added `<ProjectReference>` has access to it.**
   - Check and update `InternalsVisibleTo` for the referenced project.

6. **Validate the project with a build.**
   - Run an initial build to check for any immediate issues in the project structure.

7. **Use the MCP tool 'query-known-issues-and-solutions' to check for any known issues related to the upgrade process.**
   - Query known issues with context-specific prompts, such as:
     - "What should I do to fix `CS0246` errors in multi-targeting?"
     - "How to fix issues in `<ProjectReference>` for `net472` and `net8.0`?"

8. **Always continue to fix errors if the build still fails.**
   - After each failed build, use the query tool to find potential fixes and apply them iteratively.
   - Include error-specific fixes for common issues like missing references, build misconfigurations, etc.

9. **Before halting, provide suggested solutions if no solution has been provided.**
   - Ensure that solutions for unresolved errors are presented at the end of the process, especially if a solution wasn't found during the iterative steps.

10. **Run the build process again to validate any new changes until the main project succeeds in building.**
    - Continue running the build process until it passes successfully. Log each attempt and the result, ensuring each step contributes to resolving the issue.

## Input:
- .csproj file: Specify the path to the project file.
- Known Issues Query: Optionally provide a topic to query known issues related to the upgrade.
  - Example:
    - "C:/path/to/Project.csproj"
    - "What should we do before the first build?"
"""
